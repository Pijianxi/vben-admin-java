var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,n=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&l(e,a,t[a]);if(r)for(var a of r(t))i.call(t,a)&&l(e,a,t[a]);return e},d=("undefined"!=typeof require&&require,(e,t,a)=>new Promise(((r,o)=>{var i=e=>{try{n(a.next(e))}catch(t){o(t)}},l=e=>{try{n(a.throw(e))}catch(t){o(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,l);n((a=a.apply(e,t)).next())})));import{B as s,b as c}from"./index.ddad910d.js";import{g as p,h as u}from"./useForm.63daa5ff.js";import{b as m,c as f,A as b,d as y}from"./system.0924da72.js";import{D as g,r as h,u as v,j as w,a0 as I,F as P,a1 as x,a5 as O,w as j,a4 as F}from"./vendor.54f9b785.js";const q=[{title:"头像",dataIndex:"avatar",width:100,slots:{customRender:"avatar"}},{title:"用户名",dataIndex:"account",width:120},{title:"昵称",dataIndex:"nickname",width:120},{title:"邮箱",dataIndex:"email",width:120},{title:"创建时间",dataIndex:"createTime",width:180},{title:"角色",dataIndex:"roleName",width:120},{title:"部门",dataIndex:"deptName",width:120},{title:"备注",dataIndex:"remark",width:120}],M=[{field:"account",label:"用户名",component:"Input",colProps:{span:8}},{field:"nickname",label:"昵称",component:"Input",colProps:{span:8}}],k=[{field:"account",label:"用户名",component:"Input",helpMessage:["本字段演示异步验证","不能输入带有admin的用户名"],rules:[{required:!0,message:"请输入用户名"}]},{field:"pwd",label:"密码",component:"InputPassword",required:!0},{label:"角色",field:"role",component:"ApiSelect",componentProps:{api:m,labelField:"roleName",valueField:"id"},required:!0},{field:"dept",label:"所属部门",component:"TreeSelect",componentProps:{replaceFields:{title:"deptName",key:"id",value:"id"},getPopupContainer:()=>document.body},required:!0},{field:"nickname",label:"昵称",component:"Input",required:!0},{label:"邮箱",field:"email",component:"Input",required:!0},{label:"备注",field:"remark",component:"InputTextArea"}];var S=g({name:"AccountModal",components:{BasicModal:s,BasicForm:p},emits:["success","register"],setup(e,{emit:r}){const o=h(!0),i=h(0),[l,{setFieldsValue:s,updateSchema:p,resetFields:m,validate:g}]=u({labelWidth:100,schemas:k,showActionButtonGroup:!1,actionColOptions:{span:23}}),[I,{setModalProps:P,closeModal:x}]=c((e=>d(this,null,(function*(){yield m(),P({confirmLoading:!1}),o.value=!!(null==e?void 0:e.isUpdate),v(o)&&(i.value=e.record.id,yield s(n({},e.record)));const t=yield f();yield p([{field:"pwd",required:!v(o)},{field:"dept",componentProps:{treeData:t}}])}))));return{registerModal:I,registerForm:l,getTitle:w((()=>v(o)?"编辑账号":"新增账号")),handleSubmit:function(){return d(this,null,(function*(){try{const d=yield g();P({confirmLoading:!0});let s=d,c=v(o);if(c){s.id=i.value,(yield b(s))&&x()}else{(yield y(s))&&x()}let p=(e=n({},d),l={id:i.value},t(e,a(l)));r("success",{isUpdate:c,values:p})}finally{P({confirmLoading:!1})}var e,l}))}}}});S.render=function(e,t,a,r,o,i){const l=I("BasicForm"),n=I("BasicModal");return P(),x(n,F(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:O((()=>[j(l,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onRegister","title","onOk"])};var A=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:S});export{A,S as _,q as c,M as s};
